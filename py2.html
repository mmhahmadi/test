<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Gyro Antigravity</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #ui {
            position: absolute; top: 10px; left: 10px; color: #0f0; 
            pointer-events: none; z-index: 10;
        }
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: flex; justify-content: center;
            align-items: center; z-index: 100; color: white; text-align: center;
        }
        button {
            padding: 20px 40px; font-size: 1.2rem; background: #0f0;
            border: none; border-radius: 10px; cursor: pointer;
        }
        canvas { display: block; }
    </style>
</head>
<body>

    <div id="overlay">
        <div>
            <h1>Gyro Physics Lab</h1>
            <p>Klicke zum Starten und Erlauben der Sensoren</p>
            <button id="start-btn">SPIEL STARTEN</button>
        </div>
    </div>

    <div id="ui">
        <div>ENERGY: <span id="score">0</span></div>
        <div>GRAVITY: <span id="grav-val">X: 0, Y: 1</span></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

    <script>
        const { Engine, Render, Runner, Bodies, Composite, Mouse, MouseConstraint, Events } = Matter;

        const engine = Engine.create();
        const render = Render.create({
            element: document.body,
            engine: engine,
            options: { width: window.innerWidth, height: window.innerHeight, wireframes: false, background: 'transparent' }
        });

        // Grenzen
        const wallOpt = { isStatic: true, render: { fillStyle: '#333' } };
        Composite.add(engine.world, [
            Bodies.rectangle(window.innerWidth/2, window.innerHeight + 25, window.innerWidth, 50, wallOpt),
            Bodies.rectangle(window.innerWidth/2, -25, window.innerWidth, 50, wallOpt),
            Bodies.rectangle(-25, window.innerHeight/2, 50, window.innerHeight, wallOpt),
            Bodies.rectangle(window.innerWidth + 25, window.innerHeight/2, 50, window.innerHeight, wallOpt)
        ]);

        // Objekte spawner
        function spawn() {
            const size = 30 + Math.random() * 30;
            const box = Bodies.rectangle(window.innerWidth/2, window.innerHeight/2, size, size, {
                restitution: 0.6,
                render: { fillStyle: Math.random() > 0.5 ? '#0f0' : '#050' }
            });
            Composite.add(engine.world, box);
        }

        for(let i=0; i<12; i++) spawn();

        // Gyroskop Logik
        function handleOrientation(event) {
            // beta: Neigung vorne/hinten (-180 bis 180)
            // gamma: Neigung links/rechts (-90 bis 90)
            let gravityX = event.gamma / 20; 
            let gravityY = event.beta / 20;

            // Schwerkraft der Engine anpassen
            engine.gravity.x = gravityX;
            engine.gravity.y = gravityY;

            document.getElementById('grav-val').textContent = `X: ${gravityX.toFixed(1)}, Y: ${gravityY.toFixed(1)}`;
        }

        // Sensor-Berechtigung (Speziell für iOS)
        document.getElementById('start-btn').addEventListener('click', () => {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('deviceorientation', handleOrientation);
                        }
                    })
                    .catch(console.error);
            } else {
                // Für Android oder ältere Browser
                window.addEventListener('deviceorientation', handleOrientation);
            }
            document.getElementById('overlay').style.display = 'none';
            Render.run(render);
            Runner.run(Runner.create(), engine);
        });

        // Maus/Touch Interaktion
        const mouseConstraint = MouseConstraint.create(engine, {
            mouse: Mouse.create(render.canvas),
            constraint: { stiffness: 0.2, render: { visible: false } }
        });
        Composite.add(engine.world, mouseConstraint);
    </script>
</body>
</html>
